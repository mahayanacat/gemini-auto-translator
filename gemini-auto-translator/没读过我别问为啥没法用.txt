效果：该脚本调用谷歌gemini的api，实现中文对其他语言文本的快速全自动翻译，翻译后会自动校对，并输出最终结果。


用前须知：

1.科学上网。有谷歌邮箱账号。

2.获取gemini的api和url。使用搜索引擎搜索“build with gemini”，用谷歌邮箱账号登录。点击左边一栏第一个get api。(第二个"create prompt"里可以跟谷歌的所有AI模型直接对话，允许地区的ip完全是免费的。所有模型都可以在该页右侧选项里看到，鼠标移动上去会显示这个模型的特点、用处和额度。）
api快速入门中第一行https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent就是url地址。gemini-1.5-flash是模型名称，可以改。每个模型的额度是不同的。点击“创建api秘钥，看清楚这个秘钥是不是免费的（重要！），把秘钥复制黏贴到前端页面的API_KEY里面（如'AIzaSyDBmmbjOFEadKhLrPBL2BdH6xKMM6aQPug'之类）。代理地址举例：127.0.0.1:7890.

3.使用过程中出现任何问题都去问gemini或者别的AI就好了。

4."GET /favicon.ico HTTP/1.1" 404 Not Found，运行程序时这个报错不影响使用。

5.这个脚本在windows系统下运行。如果你需要在其他环境下运行，叫AI帮你改下main.py脚本就是了。


程序用法：

1.解压程序文件包，把gemini文件夹放在D盘根目录下。任何路径和文件夹名称的改变都需要在main.py文件中作全局修改，很麻烦，建议别改。

2.安装python环境，建议去python官网下载。安装python编辑器，如visual studio code.

3.安装脚本开头所需要的所有库：在windows系统终端powershell中以pip install +库名 安装。

4.在c:/program files下安装Tesseract、Poppler（用于 pdf2image），实现对扫描本pdf的ocr。 Tesseract（官方下载：https://github.com/UB-Mannheim/tesseract/releases）下载适用于 Windows 64 位的安装包（比如 tesseract-ocr-w64-setup-5.x.x.exe）。安装时勾选安装语言库。 Poppler（官方下载：https://github.com/oschwartz10612/poppler-windows/releases）下载最新版本的 zip 文件（比如 poppler-24.02.0-0.zip）。将下载的 zip 文件解压到C:\Program Files\Poppler 。务必在系统环境变量的path中添加二者：C:\Program Files\Poppler\bin；C:\Program Files\Tesseract-OCR（具体路径按你的实际情况）

5.双击运行start.bat文件，或在python编辑器中运行main.py。此时会弹出终端信息，运行的所有过程、报错都会在终端显示，终端全程必须保持打开状态，万不可关闭。

6.在弹出的页面上手动填写api\url\proxy，翻译和校对批次（建议都填10以下，以免超限）,待翻译文件的本地地址、希望翻译的风格（用自然语言填写，填多少都行，但太长会浪费api。基本的设定已经在程序中设置好了。）温度变量（控制输出结果的自由度，推荐0.9左右，太低或太高都会影响结果质量）。

7.点击“开始翻译”。翻译过程中可以暂停。暂停后可以继续。程序意外崩溃或关闭后，下次启动可以继续进行上次未完成的工作。确定整个文档翻译并校对完成后，按下清除键，可清除所有临时文档。注意：若过早按下清除，工作将无法恢复。

8.完成的结果输出为txt文件，自动保存在gemini-translated文件夹下。此文件夹下的temp文件夹中为保存翻译进度的文件，包括翻译进度（jason）、到目前为止翻译、校对的结果（txt），不要轻易删除，否则中途终止程序后下次无法接续。对校对后的结果不满意，也可以在这里找到原始译文，对比看看哪个更好。有时校对结果反而不如原始译文。原始译文及校对文档均是按照原文句子编号来编号的，方便后期人工核验。logs文件夹中还保存着翻译阶段出现的句子重译、补译、覆盖、失败等信息，人工核验时可重点按其编号检查。

9.出于api上限考虑，本程序暂时只支持单个工程。可选择一个已存在的未完成工程继续工作。

注意：

1.AI的工作结果与模型选择、参数（温度、batch_saize、chunk_size）、提示词设置成正相关。若发现结果不达预期，请自行实验参数和提示词设置，不同的设置会造成结果巨大的差异。

2.gmini的模型有每日限额。不同模型限额不同。达到上限后，api五次请求失败，报429错误，程序就会自动停止。等限额恢复后再启动程序，可继续上次的工作。所以理论上只要有额度，多长的文本都能译完。

3.本程序使用的分段法是以换行符分段，未必在所有语言的识别上都合适，目前适合常见的汉、英、日语等，以及藏、梵文的格式规整的文档。

4.自检逻辑能在翻译阶段自动发现漏译、缺损。校对阶段的逻辑是逐句按编号与原文校对，因此还能再补一遍。但api返回的信息不一定都是完整的（模型抽风、网络不佳都会导致返回的信息缺损），所以若要万无一失，仍需人工核验。

5.如果工作中点击了暂停，请务必等看到终端显示临时文件都已存入temp文件夹再点击继续，这个过程有点慢，请耐心等待数秒。没有必要的情况下尽量不点击暂停，让程序自己跑完。

6.扫描本pdf的ocr功能可用，但效果不保证。

7.对硬件的要求：

最低配置：

CPU：Intel i5 或 AMD Ryzen 5

内存：8GB

硬盘：10GB 可用空间

更快的网络连接
